:root{
  --bb-ease-out: cubic-bezier(.18,.9,.22,1);
  --bb-ease-inout: cubic-bezier(.2,.0,.2,1);
  --bb-hit-ease: cubic-bezier(.2,.8,.2,1);
  --bb-fx-tint-hue: 195deg;
  --bb-fx-tint-sat: 1.6;
  --bb-fx-tint-bright: 1.05;
  --bb-fx-shadow: 0 0 14px rgba(120,220,255,.35);
}

/* ================= CORE CARD ================= */

.bb-card-inner{
  position: relative;
  transform-style: preserve-3d;
}

.bb-face{
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

.bb-face.bb-back{
  transform: rotateY(180deg);
  background:
    radial-gradient(circle at 30% 20%, rgba(255,255,255,.08), rgba(0,0,0,0) 55%),
    linear-gradient(135deg, rgba(20,20,25,.98), rgba(5,5,8,.98));
  border: 1px solid rgba(255,255,255,.08);
}

/* ================= SLOT ================= */

.bb-slot{
  position: relative;
  overflow: visible;
  will-change: transform, opacity;
  transform-origin: 50% 70%;
}

/* ================= STATES ================= */

.bb-slot.is-spawn{
  animation: bb_spawn 420ms var(--bb-ease-out) both;
}

.bb-slot.is-damage{
  animation: bb_hit_shake 140ms var(--bb-hit-ease) both;
}

.bb-slot.is-attack-from{
  animation: bb_attack_lunge 240ms var(--bb-ease-out) both;
}

.bb-slot.is-attack-to{
  animation: bb_attack_recoil 220ms var(--bb-ease-out) both;
}

.bb-slot.is-dying{
  animation: bb_death_collapse 680ms var(--bb-ease-inout) both;
  filter: saturate(.35) brightness(.92) contrast(1.05);
}

/* ================= KEYFRAMES ================= */

@keyframes bb_spawn{
  from{ transform: scale(.85); opacity:0; }
  to{ transform: scale(1); opacity:1; }
}

@keyframes bb_hit_shake{
  0%{ transform: translateX(0); }
  50%{ transform: translateX(-4px); }
  100%{ transform: translateX(0); }
}

@keyframes bb_attack_lunge{
  from{ transform: translateY(0); }
  to{ transform: translateY(-6px); }
}

@keyframes bb_attack_recoil{
  from{ transform: translateY(0); }
  to{ transform: translateY(4px); }
}

@keyframes bb_death_collapse{
  from{ transform: scale(1); opacity:1; }
  to{ transform: scale(.96); opacity:.85; }
}

@keyframes bb_card_death_to_back__final{
  from{ transform: rotateY(0deg); }
  to{ transform: rotateY(180deg); }
}

/* ================= CARD STATES ================= */

.bb-slot.is-dying .bb-card{
  animation: bb_card_death_to_back__final 680ms var(--bb-ease-inout) both;
  transform-style: preserve-3d;
}

.bb-card.is-dead{
  opacity:1 !important;
  filter:none !important;
  pointer-events:none;
  position: relative;
}

/* ================= DEAD OVERLAY ================= */

.bb-card.is-dead::after{
  content:"";
  position:absolute;
  inset:0;
  background: rgba(0,0,0,.55);
  z-index:20;
}

.bb-card.is-dead::before{
  content:"";
  position:absolute;
  inset:0;
  background: url("/fx/dead_skeleton.png") center / 60% no-repeat;
  opacity:.95;
  z-index:21;
}

/* ================= FX LAYER ================= */

.bb-fx-anchor{
  position:absolute;
  inset:0;
  z-index:80;
  pointer-events:none;
  overflow:visible;
}

/* ================= DEATH FX GIF ================= */

.bb-slot.is-dying .bb-fx-anchor::before{
  content:"";
  position:absolute;
  inset:0;
  background: url("/fx/death_smoke.gif") center / cover no-repeat;
  z-index:90;
  pointer-events:none;
}

/* ================= REDUCED MOTION ================= */

@media (prefers-reduced-motion: reduce){
  .bb-slot.is-spawn,
  .bb-slot.is-damage,
  .bb-slot.is-attack-from,
  .bb-slot.is-attack-to,
  .bb-slot.is-dying{
    animation:none !important;
  }
}



/* Ensure death FX never persists or replays after dying state */
.bb-fx-anchor::before{
  opacity: 0;
}
