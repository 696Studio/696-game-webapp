
/* === FX LAYER (Hearthstone-style): FX is sibling of the card, not inside CardArt (CardArt clips with overflow:hidden) === */
.bb-slot{
  position: relative;
  overflow: visible;
}

.bb-fx-layer{
  position: absolute;
  inset: -10%;
  pointer-events: none;
  z-index: 50; /* above card */
  display: grid;
  place-items: center;
}

.bb-fx-sprite{
  width: 140%;
  height: 140%;
  background-repeat: no-repeat;
  background-position: 0 0;
  image-rendering: auto;
}

/* Default death burst strip: /public/fx/death_burst.png (horizontal frames) */
.bb-slot.is-dying .bb-fx-death{
  background-image: url("/fx/death_burst.png");
  --bb-death-frames: 8;
  background-size: calc(100% * var(--bb-death-frames)) 100%;
  animation: bbDeathBurst 650ms steps(var(--bb-death-frames)) forwards;
}

@keyframes bbDeathBurst{
  from { background-position-x: 0%; opacity: 1; transform: scale(1); }
  to   { background-position-x: 100%; opacity: 1; transform: scale(1); }
}

/* =========================================================
   696 GAME — PVP CARD ANIMATIONS (SAFE)
   ---------------------------------------------------------
   Animation state classes are applied to .bb-slot in:
   app/pvp/battle/page.tsx

   PRINCIPLES:
   - Animate only containers (transform/opacity), never layout (no left/top).
   - CardArt remains an "atom".
   - FX lives in .bb-fx / pseudo-elements.
   ========================================================= */

   :root{
    /* tweak once — affects whole battle */
    --bb-ease-out: cubic-bezier(.18,.9,.22,1);
    --bb-ease-inout: cubic-bezier(.2,.0,.2,1);
    --bb-hit-ease: cubic-bezier(.2,.8,.2,1);
  
    /* tint for cheap grayscale particles (smoke/dust) */
    --bb-fx-tint-hue: 195deg;   /* blue/cyan */
    --bb-fx-tint-sat: 1.6;
    --bb-fx-tint-bright: 1.05;
    --bb-fx-shadow: 0 0 14px rgba(120, 220, 255, .35);
  }
  
  
/* STEP A FIX: ensure FX layer is above bb-overlay (page.tsx sets .bb-fx z-index:6) */
.bb-fx{ z-index: 12 !important; }

/* Base safety */
  .bb-slot{
    will-change: transform, opacity;
    transform-origin: 50% 70%;
  }
  
  /* =========================================================
     STEP 1 — SPAWN
     ========================================================= */
  .bb-slot.is-spawn{
    animation: bb_spawn 420ms var(--bb-ease-out) both;
    filter: saturate(1.02);
  }
  @keyframes bb_spawn{
    0%   { opacity: 0; transform: translate3d(0,18px,0) scale(.92); }
    55%  { opacity: 1; transform: translate3d(0,-2px,0) scale(1.02); }
    100% { opacity: 1; transform: translate3d(0,0,0)  scale(1); }
  }
  
  /* =========================================================
     STEP 2 — HIT / DAMAGE
     ========================================================= */
  .bb-slot.is-damage{
    animation: bb_hit_shake 140ms var(--bb-hit-ease) both;
  }
  @keyframes bb_hit_shake{
    0%   { transform: translate3d(0,0,0) rotate(0deg) scale(1); }
    25%  { transform: translate3d(-2px,0,0) rotate(-0.6deg) scale(.995); }
    55%  { transform: translate3d( 2px,0,0) rotate( 0.6deg) scale(.995); }
    100% { transform: translate3d(0,0,0) rotate(0deg) scale(1); }
  }
  
  /* a clean flash overlay — cheap, but reads well */
  .bb-slot.is-damage::after{
    content:"";
    position:absolute;
    inset:-6px;
    border-radius: 14px;
    pointer-events:none;
    background: radial-gradient(closest-side, rgba(255,80,80,.35), rgba(255,80,80,0) 70%);
    mix-blend-mode: screen;
    opacity:0;
    animation: bb_hit_flash 160ms var(--bb-ease-out) both;
  }
  @keyframes bb_hit_flash{
    0%{ opacity:0; transform: scale(.96); }
    45%{ opacity:1; transform: scale(1.02); }
    100%{ opacity:0; transform: scale(1.06); }
  }
  
  /* =========================================================
     STEP 3 — ATTACK LUNGE
     .is-attack-from  => attacker lunges forward
     .is-attack-to    => victim gets tiny recoil + impact flash
     ========================================================= */
  .bb-slot.is-attack-from{
    animation: bb_attack_lunge 240ms var(--bb-ease-out) both;
  }
  @keyframes bb_attack_lunge{
    0%   { transform: translate3d(0,0,0) scale(1); }
    55%  { transform: translate3d(0,-10px,0) scale(1.03); } /* up = toward center in our vertical arena */
    100% { transform: translate3d(0,0,0) scale(1); }
  }
  
  .bb-slot.is-attack-to{
    animation: bb_attack_recoil 220ms var(--bb-ease-out) both;
  }
  @keyframes bb_attack_recoil{
    0%   { transform: translate3d(0,0,0) scale(1); }
    45%  { transform: translate3d(0,6px,0) scale(.99); }
    100% { transform: translate3d(0,0,0) scale(1); }
  }
  
  /* =========================================================
     STEP 4A — DEATH (Collapse + Ash) — NO ASSET REQUIRED
     ========================================================= */
  .bb-slot.is-dying{
    animation: bb_death_collapse 680ms var(--bb-ease-inout) both;
    filter: saturate(.35) brightness(.92) contrast(1.05);
  }


  /* Hearthstone-style card death: shake + flip + shrink (card only) */
  .bb-slot.is-dying .bb-card{
    transform-style: preserve-3d;
    will-change: transform, filter, opacity;
    animation: bb_card_death_flip 680ms var(--bb-ease-inout) both;
  }

  @keyframes bb_card_death_flip{
    0%   { transform: translate3d(0,0,0) rotate(0deg) rotateY(0deg) scale(1); filter: saturate(1) brightness(1); }
    12%  { transform: translate3d(0,-2px,0) rotate(-2deg) rotateY(0deg) scale(1.02); }
    22%  { transform: translate3d(-3px,1px,0) rotate(2deg) rotateY(10deg) scale(1.01); }
    36%  { transform: translate3d(3px,2px,0) rotate(-3deg) rotateY(-18deg) scale(.98); }
    55%  { transform: translate3d(0,8px,0) rotate(6deg) rotateY(78deg) scale(.88); filter: saturate(.7) brightness(.95); }
    100% { transform: translate3d(0,18px,0) rotate(10deg) rotateY(110deg) scale(.72); filter: saturate(.3) brightness(.9); opacity:0; }
  }
  
  /* ash overlay */
  .bb-slot.is-dying::before{
    content:"";
    position:absolute;
    inset:-6px;
    border-radius: 14px;
    pointer-events:none;
  
    background:
      radial-gradient(closest-side, rgba(210,210,210,.22), rgba(210,210,210,0) 65%),
      radial-gradient(closest-side, rgba(120,220,255,.10), rgba(120,220,255,0) 70%);
  
    mix-blend-mode: screen;
    opacity:0;
    animation: bb_ash 680ms var(--bb-ease-inout) both;
    filter: hue-rotate(var(--bb-fx-tint-hue)) saturate(var(--bb-fx-tint-sat)) brightness(var(--bb-fx-tint-bright));
  }
  @keyframes bb_ash{
    0%{ opacity:0; transform: scale(.98); }
    30%{ opacity:.55; transform: scale(1.02); }
    100%{ opacity:0; transform: scale(1.12); }
  }
  
  @keyframes bb_death_collapse{
    0%   { opacity:1; transform: translate3d(0,0,0) rotate(0deg) scale(1); }
    18%  { opacity:1; transform: translate3d(0,0,0) rotate(-1.2deg) scale(1.01); } /* micro-freeze + tilt */
    55%  { opacity:.92; transform: translate3d(0,16px,0) rotate(3.5deg) scale(.92); } /* drop + squash */
    100% { opacity:0; transform: translate3d(0,28px,0) rotate(7deg) scale(.82); }
  }
  
  /* =========================================================
     STEP 4B — OPTIONAL SPRITE POP (death_burst.png)
     Put sprite here: public/fx/death_burst.png
  
     Expected:
     - 8 frames in a row (horizontal)
     - each frame square (e.g. 256x256)
     ========================================================= */
  .bb-slot.is-dying .bb-death{
    position:absolute;
    inset:-10px;
    pointer-events:none;
    border-radius: 16px;
    opacity:1;
    z-index: 10;
  }
  
  /* sprite layer */
  .bb-slot.is-dying .bb-death::before{
    content:"";
    position:absolute;
    left:50%;
    top:50%;
    width: 320px;
    height: 320px;
    transform: translate(-50%,-55%);
    background-image: url("/fx/death_burst.png");
    background-repeat: no-repeat;
    background-size: 800% 100%;
    image-rendering: auto;
  
    /* make grayscale look "alive" */
    filter:
      hue-rotate(var(--bb-fx-tint-hue))
      saturate(var(--bb-fx-tint-sat))
      brightness(var(--bb-fx-tint-bright))
      drop-shadow(var(--bb-fx-shadow));
  
    opacity:1;
    mix-blend-mode: screen;
    animation: bb_sprite8 680ms steps(8) both;
  }
  
  /* glow halo behind sprite */
  .bb-slot.is-dying .bb-death::after{
    content:"";
    position:absolute;
    inset:0;
    background: radial-gradient(circle at 50% 50%, rgba(120,220,255,.26), rgba(120,220,255,0) 65%);
    mix-blend-mode: screen;
    opacity:0;
    animation: bb_halo 520ms var(--bb-ease-out) both;
    pointer-events:none;
  }
  
  @keyframes bb_sprite8{
    from { background-position:   0% 50%; }
    to   { background-position: 100% 50%; }
  }
  @keyframes bb_halo{
    0%{ opacity:0; transform: scale(.9); }
    25%{ opacity:.75; transform: scale(1.02); }
    100%{ opacity:0; transform: scale(1.18); }
  }
  
  /* keep it safe on low-end devices */
  @media (prefers-reduced-motion: reduce){
    .bb-slot.is-spawn,
    .bb-slot.is-damage,
    .bb-slot.is-attack-from,
    .bb-slot.is-attack-to,
    .bb-slot.is-dying{ animation: none !important; }
    .bb-slot.is-damage::after,
    .bb-slot.is-dying::before,
    .bb-slot.is-dying .bb-death::before,
    .bb-slot.is-dying .bb-death::after{ animation: none !important; opacity: 0 !important; }
  }
  